<% content_for :title, "Booking ##{@booking.id}" %>

<div class="mx-auto max-w-2xl">
  <%= render BreadcrumbComponent.new(items: [
    { label: "My Bookings", path: bookings_path },
    { label: "Booking ##{@booking.id}", path: nil }
  ]) %>

  <div class="mt-4 <%= card %>">
    <div class="mb-4 flex items-center justify-between">
      <h1 class="text-xl font-semibold text-stone-900">Booking #<%= @booking.id %></h1>
      <span class="<%= slot_status_badge_classes(@booking.status) %> rounded-full px-2.5 py-0.5 text-xs font-medium">
        <%= @booking.status.capitalize %>
      </span>
    </div>

    <% if @booking.status == "pending" %>
      <div class="mb-4 rounded-lg bg-yellow-50 p-4 text-sm text-yellow-800">
        Payment processing… This page will update once your payment is confirmed.
      </div>
    <% end %>

    <h2 class="mb-2 text-sm font-semibold text-stone-700">Sessions</h2>
    <ul class="space-y-1">
      <% @booking.slots.order(:starts_at).each do |slot| %>
        <li class="text-sm text-stone-700">
          <%= slot.starts_at.strftime("%A, %B %-d %Y · %-I:%M %p") %>
        </li>
      <% end %>
    </ul>

    <div class="mt-4 border-t border-stone-100 pt-4">
      <p class="text-sm text-stone-600">
        Total paid: <span class="font-semibold text-stone-900">
          $<%= number_with_precision(@booking.total_cents / 100.0, precision: 2) %>
        </span>
      </p>
      <% if @booking.stripe_receipt_url.present? %>
        <p class="mt-2 text-sm">
          <%= link_to "View Stripe receipt →", @booking.stripe_receipt_url,
                target: "_blank", rel: "noopener noreferrer",
                class: "text-stone-700 underline hover:text-stone-900" %>
        </p>
      <% end %>
    </div>

    <% if @booking.status == "confirmed" %>
      <div class="mt-6 border-t border-stone-100 pt-4">
        <% if @booking.within_cancellation_window? %>
          <div data-controller="confirmation-dialog">
            <button type="button" data-action="confirmation-dialog#open" class="<%= btn_danger %>">
              Cancel Booking
            </button>
            <%= render ConfirmationDialogComponent.new(
              title:         "Cancel Booking",
              message:       "Are you sure you want to cancel? A full refund will be issued to your original payment method.",
              confirm_url:   cancel_booking_path(@booking),
              confirm_label: "Yes, Cancel",
              cancel_label:  "Keep Booking"
            ) %>
          </div>
        <% else %>
          <div data-controller="confirmation-dialog">
            <button type="button" data-action="confirmation-dialog#open" class="<%= btn_danger %>">
              Cancel Booking
            </button>
            <%= render ConfirmationDialogComponent.new(
              title:         "Cancel Booking",
              message:       "Are you sure you want to cancel? No refund will be issued — you are outside the cancellation window.",
              confirm_url:   cancel_booking_path(@booking),
              confirm_label: "Yes, Cancel (No Refund)",
              cancel_label:  "Keep Booking"
            ) %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
