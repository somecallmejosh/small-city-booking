<% content_for :title, @settings&.studio_name || "Small City Studio" %>

<div data-controller="slot-selection"
     data-slot-selection-rate-cents-value="<%= @settings&.hourly_rate_cents || 0 %>">

  <div class="mb-8">
    <h1 class="text-3xl font-bold text-stone-900"><%= @settings&.studio_name || "Small City Studio" %></h1>
    <% if @settings&.studio_description.present? %>
      <p class="mt-2 text-stone-600"><%= @settings.studio_description %></p>
    <% end %>
    <p class="mt-1 text-sm text-stone-500">
      $<%= number_with_precision(@settings&.hourly_rate_cents.to_f / 100, precision: 2) %> / hour
    </p>
  </div>

  <%= turbo_stream_from "slots" %>

  <% if @slots_by_date.any? %>
    <div class="space-y-6">
      <% @slots_by_date.each do |date, slots| %>
        <div class="rounded-xl border border-stone-200 bg-white p-5 shadow-sm">
          <h2 class="mb-3 text-sm font-semibold text-stone-700">
            <%= date.strftime("%A, %B %-d") %>
          </h2>
          <div class="flex flex-wrap gap-2">
            <% slots.each do |slot| %>
              <%= render "slots/slot", slot: slot %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

    <div class="mt-6 rounded-xl border border-stone-200 bg-white p-5 shadow-sm">
      <p class="text-sm text-stone-600" data-slot-selection-target="summary">
        Select slots to book
      </p>

      <% if authenticated? %>
        <%= form_with url: slot_holds_path, method: :post, data: { turbo: false } do |f| %>
          <div class="mt-4">
            <button type="button"
                    data-slot-selection-target="checkoutButton"
                    data-action="click->slot-selection#submit"
                    class="<%= btn_primary %>"
                    disabled>
              Continue to Checkout
            </button>
          </div>
        <% end %>
      <% else %>
        <div class="mt-4">
          <%= link_to "Sign in to book", new_session_path, class: btn_primary %>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="<%= card %> text-center text-stone-500">
      No upcoming slots available. Check back soon.
    </div>
  <% end %>
</div>
