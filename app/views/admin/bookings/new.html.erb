<% content_for :title, "New Booking — Admin" %>

<div class="mb-6">
  <%= render BreadcrumbComponent.new(items: [
    { label: "Admin",    path: admin_root_path },
    { label: "Bookings", path: admin_bookings_path },
    { label: "New",      path: nil }
  ]) %>
  <h1 class="mt-1 text-2xl font-semibold text-stone-900">New Booking</h1>
</div>

<div class="max-w-2xl">
  <%= form_with url: admin_bookings_path, method: :post do |f| %>
    <div class="space-y-6">

      <div class="<%= card %>">
        <h2 class="mb-4 text-sm font-semibold text-stone-700">Customer</h2>
        <label class="<%= form_label %>" for="booking_user_id">Select customer</label>
        <select name="booking[user_id]" id="booking_user_id" class="<%= input_field %>">
          <option value="">— choose a customer —</option>
          <% @users.each do |user| %>
            <option value="<%= user.id %>">
              <%= user.name.presence || user.email_address %> (<%= user.email_address %>)
            </option>
          <% end %>
        </select>
      </div>

      <div class="<%= card %>">
        <h2 class="mb-4 text-sm font-semibold text-stone-700">Available Slots</h2>
        <% if @available_slots.any? %>
          <div class="max-h-64 space-y-1.5 overflow-y-auto">
            <% @available_slots.each do |slot| %>
              <label class="flex items-center gap-3 rounded-lg border border-stone-200 px-3 py-2 text-sm text-stone-700 hover:bg-stone-50 cursor-pointer">
                <input type="checkbox"
                       name="booking[slot_ids][]"
                       value="<%= slot.id %>"
                       class="h-4 w-4 rounded border-stone-300 text-stone-900">
                <%= slot.starts_at.strftime("%a, %b %-d %Y · %-I:%M %p") %>
              </label>
            <% end %>
          </div>
        <% else %>
          <p class="text-sm text-stone-400">No open slots available. <%= link_to "Create some →", new_admin_slot_path, class: "text-stone-700 underline" %></p>
        <% end %>
      </div>

      <div class="<%= card %>">
        <h2 class="mb-4 text-sm font-semibold text-stone-700">Notes <span class="font-normal text-stone-400">(optional)</span></h2>
        <textarea name="booking[notes]"
                  id="booking_notes"
                  rows="3"
                  placeholder="Internal notes about this booking…"
                  class="<%= input_field %> resize-none"></textarea>
      </div>

      <div class="<%= card %>">
        <h2 class="mb-4 text-sm font-semibold text-stone-700">Payment</h2>
        <label class="flex items-start gap-3 text-sm text-stone-700 cursor-pointer">
          <input type="checkbox"
                 name="booking[generate_payment_link]"
                 value="1"
                 id="booking_generate_payment_link"
                 class="mt-0.5 h-4 w-4 rounded border-stone-300">
          <div>
            <span class="font-medium">Generate Stripe Payment Link</span>
            <p class="mt-0.5 text-stone-500">Creates a shareable link for the customer to pay online. Total is calculated from selected slots × hourly rate.</p>
          </div>
        </label>
      </div>

      <div class="flex items-center gap-4">
        <%= f.submit "Create Booking", class: btn_primary %>
        <%= link_to "Cancel", admin_bookings_path, class: "text-sm text-stone-500 hover:text-stone-700" %>
      </div>

    </div>
  <% end %>
</div>
